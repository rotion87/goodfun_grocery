<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>2025 å­¤èŠ³å°éšŠ GOOD FUN TEAM in è‰ç‡å­£</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Noto+Sans+TC:wght@400;600;700;900&display=swap" rel="stylesheet">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* è®“å…§å®¹åº•éƒ¨è‡ªå‹•ç•™å‡ºèªè¨€åˆ‡æ›éˆ•çš„é«˜åº¦ï¼ˆå« iPhone å®‰å…¨å€ï¼‰ */
.safe-bottom { padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 96px); }
/* èªè¨€åˆ‡æ›éˆ•å›ºå®šåœ¨å·¦ä¸‹ï¼Œä½†è€ƒæ…®å®‰å…¨å€ */
.lang-fab { bottom: calc(env(safe-area-inset-bottom, 0px) + 18px); }
@media (max-width: 640px){
  .lang-fab { transform: scale(0.92); } /* å°è¢å¹•ç¨å¾®ç¸®ä¸€é» */}
    :root{ --red:#ff2b2b; --blue:#13a0ff; --yellow:#ffe200; --green:#00b050; --ink:#101010; --paper:#fffbe9; --cream:#fff5c2; --dot:#0a5bd6; }
    html,body{height:100%}
    body{font-family:'Noto Sans TC',system-ui,-apple-system,Segoe UI,Roboto,'PingFang TC','Microsoft JhengHei',sans-serif;color:var(--ink)}
    .bg-fruit{
      background:
        radial-gradient(circle at -10% -10%, rgba(255,255,255,.35) 0 25%, transparent 26%),
        radial-gradient(circle at 110% 110%, rgba(255,255,255,.35) 0 25%, transparent 26%),
        repeating-radial-gradient(circle at 20% 10%, rgba(255,255,255,.65) 0 4px, transparent 5px 10px),
        radial-gradient(ellipse at top, #fffaf0, var(--cream) 45%, #ffeec2 85%);
    }
    .dot-overlay{position:fixed;inset:0;pointer-events:none;z-index:0;background-image:radial-gradient(var(--dot) 2px,transparent 2px);background-size:26px 26px;opacity:.12;mix-blend-multiply}
    .hero-title{font-family:'Bangers',system-ui;letter-spacing:1px;text-shadow:2px 2px 0 #00000020}
    .burst{position:relative;display:inline-flex;align-items:center;justify-content:center;padding:.35rem .6rem;font-weight:900;color:#111;text-shadow:1px 1px 0 #fff}
    .burst:before{content:"";position:absolute;inset:-6px;z-index:-1;background:conic-gradient(from 0deg, var(--yellow) 0 25%, #ffd100 25% 50%, var(--yellow) 50% 75%, #ffd100 75% 100%);-webkit-mask:radial-gradient(circle,transparent 38%,#000 39%),conic-gradient(from 0deg,#000 0 100%);border-radius:50%}
    .card{border:3px solid #111;box-shadow:6px 6px 0 #111;background:#fff;border-radius:18px;overflow:hidden}
    .card img{width:100%;height:15rem;object-fit:cover;background:#e7e7e7}
    .label{font-family:'Bangers';letter-spacing:.5px}
    .btn{border:3px solid #111;background:#fff;box-shadow:4px 4px 0 #111;font-weight:700}
    .btn:hover{transform:translate(-1px,-1px)}
    .lang-pill{border:3px solid #111;background:var(--yellow);box-shadow:4px 4px 0 #111}
    .modal{position:fixed;inset:0;z-index:50}
    .modal-back{position:absolute;inset:0;background:rgba(16,16,16,.55)}
    .modal-body{position:absolute;left:50%;transform:translateX(-50%);top:8vh;width:min(780px,92vw);background:#fff;border:4px solid #111;box-shadow:10px 10px 0 #111;border-radius:22px}
    @keyframes ripple-anim{to{transform:scale(12);opacity:0}}

    /* æ‰“å¡äº’å‹•ï¼ˆæ‹–æ›³å…¥æ§½ï¼‰ */
    @keyframes stamp-pop{0%{transform:scale(.7) rotate(-6deg);opacity:0}60%{transform:scale(1.1) rotate(0deg);opacity:1}100%{transform:scale(1);opacity:1}}
    .punch-slot{position:absolute; left:50%; top:72%; transform:translate(-50%,-50%); width:min(64%,520px); height:16px; background:#111; border-radius:6px; box-shadow:0 3px 0 #0005; opacity:.9;}
    .punch-card{
      position:absolute; left:50%; top:58%; transform:translate(-50%,-50%);
      width:min(58%,480px); max-width:90vw; aspect-ratio:3/2;
      border-radius:12px; box-shadow:8px 10px 0 #111; border:4px solid #111; background:#fff; overflow:hidden;
      touch-action:none; user-select:none; cursor:grab; height:clamp(140px, 28vw, 240px); z-index:19;
    }
    .punch-card:active{cursor:grabbing}
    .punch-stamp{position:absolute; right:10px; bottom:10px; background:#fff; border:3px dashed #111; padding:.35rem .6rem; border-radius:8px; font-family:ui-monospace,Menlo,Consolas,monospace; font-weight:800; letter-spacing:.5px; opacity:0;}
    .punch-stamp.show{animation:stamp-pop 420ms ease-out both}
    .fade-out{animation:fadeOut .5s ease forwards}
    @keyframes fadeOut{to{opacity:0;visibility:hidden}}

    /* æ¸¸å‹•æ°´æœï¼ˆç•™è¨€æ¿ï¼‰ */
    .float-layer{position:fixed; inset:0; pointer-events:none; z-index:5;}
    .fruit-chip{position:absolute; display:flex; align-items:center; gap:.35rem; background:rgba(255,255,255,.9); border:3px solid #111; border-radius:999px; padding:.2rem .6rem; box-shadow:4px 4px 0 #111; font-weight:800; white-space:nowrap; transform:translate(-50%,-50%);}
    .fruit-emoji{font-size:1.2rem; line-height:1;}
    .fruit-name{font-size:.82rem}
  </style>
</head>
<body class="bg-fruit">
  <div class="dot-overlay"></div>
  <div id="app" class="relative z-10"></div>

  <script>
    /* å…¨ç«™ ripple */
    (function(){const s='button,a,img,[role="button"]';function e(t){const r=t.target.closest(s);if(!r)return;const n=r.tagName==='IMG'&&r.parentElement?r.parentElement:r,o=n.getBoundingClientRect(),a=(t.clientX||(o.left+o.width/2))-o.left,i=(t.clientY||(o.top+o.height/2))-o.top,l=Math.max(o.width,o.height),c=l*2,p=document.createElement('span');p.className='ripple-effect';p.style.cssText=`position:absolute;border-radius:9999px;transform:scale(0);opacity:.25;background:rgba(0,0,0,.18);pointer-events:none;left:${a-c/2}px;top:${i-c/2}px;width:${c}px;height:${c}px;animation:ripple-anim .6s ease-out forwards`;n.style.position='relative';n.style.overflow='hidden';n.appendChild(p);p.addEventListener('animationend',()=>p.remove(),{once:!0})}document.addEventListener('click',e,!0)})();
  </script>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    /* === GAS API è¨­å®š ===
       æ­¥é©Ÿï¼šæŠŠä¸‹é¢ API_URL æ›æˆä½ éƒ¨ç½²å¾Œçš„ Web App URLï¼ˆ/execï¼‰
       è‹¥ç•™ç©ºæˆ–ä¸æ˜¯ httpsï¼Œé é¢æœƒè‡ªå‹•ç”¨ localStorage å…ˆè·‘ï¼Œä¹‹å¾Œå†åˆ‡æ›ä¹ŸOK */
    const API_URL = 'https://script.google.com/macros/s/AKfycbyqXdNd0VsgaDg3jNIMmL3A3dSYjnovi54AC-ze1buRO0mK7AMOLeo3JquQwpSSABU/exec';  // â†â† åœ¨é€™è£¡è²¼ä¸Šä½ çš„ GAS Web App URLï¼Œå¦‚ï¼š'https://script.google.com/macros/s/XXXX/exec'
    const FRUITS = ['ğŸ','ğŸŒ','ğŸŠ','ğŸ‡','ğŸ‰','ğŸ','ğŸ“','ğŸ‘','ğŸ¥','ğŸ'];
    const STORAGE_KEY = 'gft-guests-v1';

    const useCloud = () => /^https?:\/\//.test(API_URL);

    async function apiFetchGuests(){
      if (!useCloud()){
        // æœ¬æ©Ÿæ¨¡å¼
        try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); }catch(e){ return []; }
      }
      // é›²ç«¯ï¼ˆGASï¼‰
      const res = await fetch(API_URL, { method:'GET' });
      const json = await res.json();
      if (!json.ok) throw new Error(json.error||'fetch_failed');
      return json.data || [];
    }
    async function apiAddGuest(name){
      const fruit = FRUITS[Math.floor(Math.random()*FRUITS.length)];
      if (!useCloud()){
        // æœ¬æ©Ÿæ¨¡å¼
        const list = await apiFetchGuests();
        const next = [...list, {name, fruit}];
        try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(next)); }catch(e){}
        return {name, fruit};
      }
      // é›²ç«¯ï¼ˆGASï¼‰
      const res = await fetch(API_URL, {
        method:'POST', headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ name, fruit })
      });
      const json = await res.json();
      if (!json.ok) throw new Error(json.error||'post_failed');
      return { name, fruit };
    }

    /* i18nï¼ˆä¸­æ–‡ä¸»ï¼‰ */
    const i18n = {
      zh: {
        flag:'ğŸ‡¹ğŸ‡¼', langLabel:'ç¹ä¸­',
        siteTitle:'2025 å­¤èŠ³å°éšŠ GOOD FUN TEAM in è‰ç‡å­£',
        siteDesc:'æ°´æœåº—é¢¨æ ¼ãƒ»ä½œå“èˆ‡è¨­è¨ˆç†å¿µä¸€é å¼å±•è¦½',
        nav:{works:'ä½œå“',concept:'è¨­è¨ˆç†å¿µ',about:'é—œæ–¼',board:'ç•™è¨€æ¿'},
        btn:{brief:'ç²¾ç°¡',full:'å®Œæ•´ç‰ˆ',enter:'é€²å…¥ç¶²ç«™',close:'é—œé–‰',sign:'ç°½åˆ°'},
        punch:{title:'æ‰“å¡æˆåŠŸ',tip:'æ‚¨åˆ°è¨ªçš„æ™‚é–“ï¼š'},
        board:{ title:'ç•™è¨€æ¿ / ç°½åˆ°', hint:'è¼¸å…¥åå­—å¾Œé€å‡ºï¼ŒæœƒåŒ–èº«ç‚ºä¸€é¡†æ°´æœåœ¨é é¢æ¸¸å‹• ğŸ‘', input:'ä½ çš„åå­—' },
        works:[
          {key:'inplace',title:'ã€Šç©ºå¿ƒ In Placeã€‹',tag:'æ”å½±ï¼æ›¸ç± Ã— æ°´æ³¥ç‰©ä»¶',cover:'images/inplace.png',
           brief:['æ‘ºé å°èªŒç½®å…¥ç‰¹è£½æ°´æ³¥ç£šï¼›æ‹‰èµ·æ‘ºé æ™‚ï¼Œç£šé«”éš¨ä¹‹å±¤å±¤ã€Œå †ç–Šã€ã€‚'],
           full:['èª•ç”Ÿæ–¼ç”Ÿæ´»ç’°å¢ƒæ”¹è®Šä¹‹å¾Œï¼Œæ˜¯ä¸€å ´å¾æ—¥å¸¸å»¶ä¼¸å‡ºçš„è§€å¯Ÿèˆ‡æ”¶é›†ã€‚ç‚ºäº†å¸ƒç½®æ–°å®¶ï¼Œå¶ç„¶çœ‹è¦‹ä»¥æ°´æ³¥ç©ºå¿ƒç£šå †ç–Šçš„å®¶å…·ï¼Œå¾æ­¤ç•™æ„è¡—é ­å„å¼ç©ºå¿ƒç£šï¼Œä¸¦åœ¨æ‹æ”èˆ‡æ”¶é›†ä¹‹é–“çœ‹è¦‹è‡ªå·±çš„æŠ•å½±ã€‚','æ‘ºé å°èªŒè¢«ç½®å…¥ç‰¹è£½æ°´æ³¥ç£šä¸­ï¼›ç•¶è§€è€…æ‹‰èµ·æ‘ºé ï¼Œç£šé«”æœƒå±¤å±¤å †ç–Šï¼Œè±¡å¾µåŸå¸‚çš„å †ç Œèˆ‡ç”Ÿæ´»ç¯€å¥çš„é‡çµ„ã€‚In Place ä¸åªæ˜¯ã€Œåœ¨æŸè™•ã€ï¼Œæ›´æ˜¯æŒçºŒèª¿æ•´ã€å°‹æ‰¾å®‰æ”¾é»çš„éç¨‹ã€‚']},
          {key:'postbook',title:'ã€ŠPOSTBOOK â€“ Taiwan / Japanã€‹',tag:'è²¼ç´™ç°¿',cover:'images/postbook.png',
           brief:['ä»¥ã€Œè­·ç…§ã€ç‚ºéˆæ„Ÿï¼šå°ç£ç¯‡è¨˜éŒ„åŸå¸‚ç‰©ä»¶ï¼›æ—¥æœ¬ç¯‡æ”¶éŒ„æ±äº¬æ¨™èªèˆ‡å‰ç¥¥ç‰©ã€‚'],
           full:['è²¼ç´™æˆç‚ºç§»å‹•çš„èªè¨€â€”â€”åœ¨ä¸åŒåŸå¸‚ç•™ä¸‹éŠèµ°çš„ç—•è·¡ã€‚']},
          {key:'handit',title:'ã€ŠHand-it æ‰‹å¿ƒè²¼ã€‹',tag:'ä¾¿åˆ©è²¼',cover:'images/handit.png',
           brief:['æ€•å¿˜è¨˜çš„äº‹ï¼Œå¯«åœ¨æ‰‹å¿ƒå°±å¥½ã€‚'],
           full:['æŠŠå¯«åœ¨æ‰‹ä¸Šçš„ç¿’æ…£ï¼Œè½‰åŒ–æˆå¯ä»¥åˆ†äº«çš„ä¾¿åˆ©è²¼ï¼Œè®“æé†’ä¸åªç•™åœ¨æ‰‹ä¸Šï¼Œä¹Ÿèƒ½ç•™åœ¨ç”Ÿæ´»è£¡ã€‚']},
          {key:'softdrinks',title:'ã€ŠSoft Drinksã€‹',tag:'çµ²å·¾ Ã— é‹ç½åŒ…è£',cover:'images/softdrinks.png',
           brief:['å°‡çµ²å·¾æ”¶ç´æ–¼é‹ç½ä¸­ï¼Œä½œç‚ºã€Œæƒ…ç·’ç½è£ã€çš„è±¡å¾µã€‚'],
           full:['æŸ”è»Ÿçš„å¸ƒæ–™èˆ‡å …ç¡¬å®¹å™¨å°æ¯”ï¼Œå‘ˆç¾è¢«å°å­˜å»ä»åœ¨æµå‹•çš„æ„Ÿå—ã€‚']},
          {key:'horsecard',title:'ã€Šå­¤èŠ³å°éšŠ é¦¬å¹´è³€å¡ã€‹',tag:'å­”ç‰ˆå°åˆ· Ã— åŸå‹å…¬ä»”',cover:'images/horsecard.png',
           brief:['æ–æ–é¦¬ Ã— å…©ä½è§’è‰²ï¼ˆè€é¼ ï¼é›ªè²‚ï¼‰ Ã— è³½é¦¬æ„è±¡ã€‚'],
           full:['æ‰‹æåŸå‹ä¸Šè‰²å¾Œæ‹æ”ï¼Œè½‰ç‚ºå­”ç‰ˆå°åˆ·æ˜ä¿¡ç‰‡ï¼Œç¾å ´äº¦å±•å‡ºåŸå‹å…¬ä»”ã€‚']},
          {key:'exhibit-horse',title:'å±•ç¤ºç‰©ï½œé¦¬å¹´å…¬ä»”',tag:'æ‰‹ä½œï¼å…¬ä»”',cover:'./exhibit-horse.png',
           brief:['å°æ‡‰è³€å¡ä¸»é¡Œçš„ç«‹é«”åŸå‹ï¼Œç´„ 15 å…¬åˆ†é«˜ã€‚'],full:['å±•ç¤ºæ‰‹ä½œè³ªåœ°èˆ‡ä¸Šè‰²ç´°ç¯€ã€‚']},
          {key:'exhibit-pipo',title:'å±•ç¤ºç‰©ï½œPIPOå› å¼µå­',tag:'ç´™è£½å¼µå­',cover:'./exhibit-pipo.png',
           brief:['ä»¥æ—¥æœ¬è­¦å¯Ÿå‰ç¥¥ç‰©ç‚ºä¸»é¡Œçš„å¼µå­ç´™å¶ã€‚'],full:['ä¿ç•™æ‰‹æè‚Œç†èˆ‡æ—¥å…‰é™°å½±ï¼Œå±•ç¾è¼•å·§èˆ‡ä»½é‡æ„Ÿçš„å¹³è¡¡ã€‚']},
          {key:'exhibit-radio',title:'å±•ç¤ºç‰©ï½œå­¤èŠ³æ”¶éŸ³æ©Ÿ',tag:'é€ å‹è£ç½®',cover:'./exhibit-radio.png',
           brief:['å…©ä½è§’è‰²çµæ§‹èåˆçš„é€ å‹éŸ³éŸ¿ï¼Œå¤©ç·šæˆç‚ºè¦–è¦ºç„¦é»ã€‚'],full:['æˆç‚ºæ”¤ä½çš„è½è¦ºèˆ‡è¦–è¦ºæ¨™èªŒã€‚']},
        ],
        concept:['é—œæ³¨åŸå¸‚ä¸­çš„æš«å±…ã€ç§»å‹•èˆ‡å®‰æ”¾ï¼›ä»¥ã€ŒæŸ”è»Ÿ Ã— å …å›ºã€çš„åª’æå°ä½ï¼Œè«‡è¨˜æ†¶èˆ‡ç”Ÿæ´»è·é›¢ã€‚'],
        about:['å­¤èŠ³å°éšŠ GOOD FUN TEAM ç”± Rotion87 èˆ‡ç¾…å…±åŒç¶“ç‡Ÿã€‚','Rotion87ï¼šæ”å½±ï¼æ›¸ç±ï¼ç‰©ä»¶è¨­è¨ˆ','ç¾…ï¼ˆl72uo_ï¼‰ï¼šé€ å‹ï¼æ‰‹ä½œï¼è§’è‰²è¨­å®š']
      },
      en:{flag:'ğŸ‡ºğŸ‡¸',langLabel:'EN'}, ja:{flag:'ğŸ‡¯ğŸ‡µ',langLabel:'æ—¥æœ¬èª'}, ko:{flag:'ğŸ‡°ğŸ‡·',langLabel:'í•œêµ­ì–´'}
    };

    /* å·¦ä¸‹è§’èªè¨€åˆ‡æ› */
    const LangSwitcher = ({ current, onChange }) => (
<div className="fixed left-4 lang-fab z-50 flex items-center gap-2 px-3 py-2 bg-white lang-pill rounded-full">        {Object.entries(i18n).map(([code, conf]) => (
          <button key={code} onClick={()=>onChange(code)} title={conf.langLabel}
            className={`text-xl leading-none px-2 py-1 rounded-full ${current===code?'bg-black text-white':'hover:bg-black/5'}`}>{conf.flag}</button>
        ))}
      </div>
    );

    const Badge = ({ children }) => (<span className="burst label">{children}</span>);

    const WorkCard = ({ w, onOpen }) => (
      <div className="card">
        <button className="block w-full" onClick={()=>onOpen(w)} aria-label={`Open ${w.title}`}>
          <img src={w.cover} alt={w.title}
            onError={(e)=>{e.currentTarget.onerror=null;e.currentTarget.src='data:image/svg+xml;utf8,'+encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='800'><rect width='100%' height='100%' fill='%23f2f2f2'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='28' fill='%23999'>${w.cover} å°šæœªä¸Šå‚³</text></svg>`);}}/>
        </button>
        <div className="p-5">
          <div className="flex items-center justify-between gap-3">
            <h3 className="text-xl font-extrabold label">{w.title}</h3>
            {w.tag && <Badge>{w.tag}</Badge>}
          </div>
          <p className="text-sm mt-2">{w.brief?.[0]}</p>
          <div className="mt-3 text-xs opacity-60">é»åœ–ç‰‡çœ‹å®Œæ•´ä»‹ç´¹</div>
        </div>
      </div>
    );

    const WorkModal = ({ open, onClose, w, t }) => {
      const [tab,setTab]=React.useState('brief');
      React.useEffect(()=>{setTab('brief')},[w]);
      if(!open||!w) return null;
      return (
        <div className="modal">
          <div className="modal-back" onClick={onClose}></div>
          <div className="modal-body">
            <div className="p-6">
              <div className="flex items-start justify-between gap-4">
                <div>
                  <h3 className="text-2xl label">{w.title}</h3>
                  <div className="mt-2 flex items-center gap-2">
                    <button className={`btn px-3 py-1 rounded-full ${tab==='brief'?'bg-yellow-300':''}`} onClick={()=>setTab('brief')}>{t.btn.brief}</button>
                    <button className={`btn px-3 py-1 rounded-full ${tab==='full'?'bg-yellow-300':''}`} onClick={()=>setTab('full')}>{t.btn.full}</button>
                    {w.tag && <Badge>{w.tag}</Badge>}
                  </div>
                </div>
                <button className="btn px-3 py-1 rounded-full bg-white" onClick={onClose}>{t.btn.close}</button>
              </div>
              <div className="mt-4 space-y-2 text-sm leading-relaxed">{(tab==='brief'?w.brief:w.full)?.map((p,i)=>(<p key={i}>{p}</p>))}</div>
            </div>
          </div>
        </div>
      );
    };

    /* äº’å‹•å¼æ‰“å¡ï¼šæ‹–æ›³å¡ç‰‡é€²å¡æ§½ â†’ éŸ³æ•ˆ + é¡¯ç¤ºæ™‚é–“ â†’ æ·¡å‡º */
    const PunchOverlay = ({ t, onEnter }) => {
      const wrapRef = useRef(null);
      const cardRef = useRef(null);
      const slotRef = useRef(null);
      const stampRef = useRef(null);
      const [ts,setTs]=useState('');
      const [done,setDone]=useState(false);

      useEffect(()=>{
        const fmt=(n)=>n.toString().padStart(2,'0');
        const now=new Date();
        setTs(`${now.getFullYear()}-${fmt(now.getMonth()+1)}-${fmt(now.getDate())} ${fmt(now.getHours())}:${fmt(now.getMinutes())}:${fmt(now.getSeconds())}`);
      },[]);

      useEffect(()=>{
        const el = cardRef.current;
        if(!el) return;

        let startX=0,startY=0, dragging=false;

        const getPos=(e)=> e.touches?.[0] ? {x:e.touches[0].clientX,y:e.touches[0].clientY} : {x:e.clientX,y:e.clientY};

        const onStart=(e)=>{ dragging=true; const p=getPos(e); startX=p.x; startY=p.y; el.style.transition='none'; };
        const onMove=(e)=>{
          if(!dragging) return;
          e.preventDefault();
          const p=getPos(e);
          const dx=(p.x-startX), dy=(p.y-startY);
          el.style.transform=`translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
          el.style.zIndex = 20;
        };
        const overlap=(a,b)=> !(a.right<b.left || a.left>b.right || a.bottom<b.top || a.top>b.bottom);
        const onEnd=()=>{
          if(!dragging) return;
          dragging=false;
          const cardRect=el.getBoundingClientRect();
          const slotRect=slotRef.current.getBoundingClientRect();
          if (overlap(cardRect, slotRect)) {
            try { new Audio('punch.mp3').play().catch(()=>{}); } catch(e) {}
            if (navigator.vibrate) navigator.vibrate(25);
            stampRef.current.classList.add('show');
            setTimeout(()=>{ setDone(true); }, 350);
            setTimeout(()=>{ onEnter(); }, 850);
          } else {
            el.style.transition='transform .25s ease';
            el.style.transform='translate(-50%, -50%)';
          }
        };

        el.addEventListener('mousedown', onStart);
        window.addEventListener('mousemove', onMove, {passive:false});
        window.addEventListener('mouseup', onEnd);
        el.addEventListener('touchstart', onStart, {passive:true});
        window.addEventListener('touchmove', onMove, {passive:false});
        window.addEventListener('touchend', onEnd);

        return ()=>{
          el.removeEventListener('mousedown', onStart);
          window.removeEventListener('mousemove', onMove);
          window.removeEventListener('mouseup', onEnd);
          el.removeEventListener('touchstart', onStart);
          window.removeEventListener('touchmove', onMove);
          window.removeEventListener('touchend', onEnd);
        };
      },[onEnter]);

      return (
        <div ref={wrapRef} className={`fixed inset-0 z-[60] bg-white/88 backdrop-blur-sm flex items-center justify-center p-6 ${done?'fade-out':''}`}>
          <div className="w-full max-w-3xl bg-white border-[4px] border-black rounded-2xl shadow-[10px_10px_0_#111] overflow-hidden">
            <div className="relative">
              <img src="punch.png" alt="æ‰“å¡æ©Ÿ" className="w-full max-h-[560px] object-contain bg-white" />
              <div ref={slotRef} className="punch-slot" style={{zIndex:15}}></div>
              <div ref={cardRef} className="punch-card">
                <img src="punch-card.png" alt="" className="absolute inset-0 w-full h-full object-cover" onError={(e)=>{ e.currentTarget.style.display='none'; }} />
                <div className="absolute left-2 top-2 bg-[var(--yellow)] border-4 border-black rounded-lg shadow-[6px_6px_0_#111] px-2 py-1 label">GOOD FUN TEAM</div>
                <div ref={stampRef} className="punch-stamp">{ts || 'â€”:â€”:â€”'}</div>
              </div>
            </div>
            <div className="p-3 flex items-center justify-end">
              <span className="text-xs opacity-60 mr-auto pl-2">æŠŠå¡ç‰‡æ‹–åˆ°æ‰“å¡æ§½ä»¥é€²å…¥ç¶²ç«™</span>
            </div>
          </div>
        </div>
      );
    };

    /* æ¸¸å‹•æ°´æœåœ–å±¤ */
    const FruitLayer = ({ items }) => {
      const layerRef = useRef(null);
      const animRef  = useRef(null);
      const objsRef  = useRef([]);

      useEffect(()=>{
        const layer = layerRef.current; if(!layer) return;
        layer.innerHTML = ''; objsRef.current = [];
        items.forEach((it)=>{
          const el = document.createElement('div');
          el.className = 'fruit-chip';
          el.innerHTML = `<span class="fruit-emoji">${it.fruit}</span><span class="fruit-name">${it.name}</span>`;
          layer.appendChild(el);
          const vw = window.innerWidth, vh = window.innerHeight;
          const x = Math.random()*vw, y = Math.random()*vh*0.8 + vh*0.1;
          const vx = (Math.random()*0.6+0.2) * (Math.random()<0.5?-1:1);
          const vy = (Math.random()*0.4+0.1) * (Math.random()<0.5?-1:1);
          objsRef.current.push({el, x, y, vx, vy});
        });
        const tick = ()=>{
          const vw = window.innerWidth, vh = window.innerHeight;
          objsRef.current.forEach(o=>{
            o.x += o.vx; o.y += o.vy;
            if (o.x < 40 || o.x > vw-40) o.vx *= -1;
            if (o.y < 60 || o.y > vh-60) o.vy *= -1;
            o.el.style.left = o.x + 'px';
            o.el.style.top  = o.y + 'px';
          });
          animRef.current = requestAnimationFrame(tick);
        };
        tick();
        return ()=> cancelAnimationFrame(animRef.current);
      },[items]);

      return <div ref={layerRef} className="float-layer"></div>;
    };

    /* ç°½åˆ°ç•™è¨€æ¿ï¼ˆè‡ªå‹•åˆ¤æ–·ï¼šGAS æˆ– localStorageï¼‰ */
    const SignBoard = ({ t }) => {
      const [name,setName] = useState('');
      const [list,setList] = useState([]);
      const [loading,setLoading] = useState(true);
      const [posting,setPosting] = useState(false);
      const [err,setErr] = useState('');

      useEffect(()=>{
        (async ()=>{
          try{
            setLoading(true);
            const data = await apiFetchGuests();
            setList(data);
          }catch(e){ setErr('ç„¡æ³•è¼‰å…¥ç•™è¨€æ¿ï¼Œç¨å¾Œå†è©¦'); }
          finally{ setLoading(false); }
        })();
      },[]);

      const add = async ()=>{
        const n = name.trim(); if(!n) return;
        try{
          setPosting(true);
          const obj = await apiAddGuest(n);
          setList(prev=>[...prev, obj]);
          setName('');
        }catch(e){ setErr('é€å‡ºå¤±æ•—ï¼Œç¨å¾Œå†è©¦'); }
        finally{ setPosting(false); }
      };

      return (
        <>
          <FruitLayer items={list} />
          <div className="card p-6 mt-10 mb-24">
            <div className="flex items-center justify-between gap-3">
              <h3 className="text-2xl label">{t.board.title}</h3><Badge>BOARD</Badge>
            </div>
            <p className="text-sm opacity-80 mt-2">{t.board.hint}ï¼ˆç›®å‰æ¨¡å¼ï¼š{useCloud()?'é›²ç«¯':'æœ¬æ©Ÿ'}ï¼‰</p>
            <div className="mt-4 flex gap-2">
              <input value={name} onChange={e=>setName(e.target.value)} placeholder={t.board.input} className="flex-1 rounded-xl border-2 border-black px-3 py-2" />
              <button onClick={add} disabled={posting} className="btn px-4 py-2 rounded-xl bg-[var(--yellow)]">{posting ? 'é€å‡ºä¸­â€¦' : t.btn.sign}</button>
            </div>
            {loading && <div className="mt-3 text-sm opacity-70">è¼‰å…¥ä¸­â€¦</div>}
            {err && <div className="mt-3 text-sm text-red-600">{err}</div>}
            {!loading && list.length>0 && (<div className="mt-4 text-sm opacity-70">ç›®å‰å…± {list.length} ä½ä¾†è³“</div>)}
          </div>
        </>
      );
    };

    function App(){
      const [lang,setLang]=useState('zh');
      const t=i18n[lang]||i18n.zh;
      const [open,setOpen]=useState(null);
      const [showPunch,setShowPunch]=useState(true);

      return (
        <div className="min-h-screen relative z-10 safe-bottom">
          <LangSwitcher current={lang} onChange={setLang} />
          <div className="fixed right-4 top-4 z-40 flex flex-col gap-3">
            <a href="https://www.instagram.com/rotion87" target="_blank" className="block w-12 h-12 rounded-full border-[3px] border-black bg-white shadow-[6px_6px_0_#111] overflow-hidden" aria-label="IG rotion87">
              <img src="ig-rotion.png" alt="IG rotion87" className="w-full h-full object-cover"/>
            </a>
            <a href="https://www.instagram.com/l72uo_" target="_blank" className="block w-12 h-12 rounded-full border-[3px] border-black bg-white shadow-[6px_6px_0_#111] overflow-hidden" aria-label="IG l72uo_">
              <img src="ig-l72uo.png" alt="IG l72uo_" className="w-full h-full object-cover"/>
            </a>
          </div>

          <div className="max-w-6xl mx-auto px-4 md:px-8 py-10">
            <header className="mb-6">
              <h1 className="hero-title text-4xl md:text-5xl text-[var(--red)] drop-shadow" style={{ WebkitTextStroke: '2px #111' }}>{t.siteTitle}</h1>
              <div className="mt-2 inline-flex items-center gap-2">
                <Badge>QUALITY</Badge><Badge>FRESH</Badge><Badge>GOOD FUN</Badge>
              </div>
              <p className="text-sm opacity-80 mt-2">{t.siteDesc}</p>
            </header>

            <section className="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
              {t.works.map((w)=>(<WorkCard key={w.key} w={w} onOpen={setOpen} />))}
            </section>

            <section className="mt-10 grid md:grid-cols-2 gap-6">
              <div className="card p-6">
                <div className="flex items-center justify-between gap-3"><h3 className="text-2xl label">è¨­è¨ˆç†å¿µ</h3><Badge>CONCEPT</Badge></div>
                <div className="mt-3 space-y-2 text-sm leading-relaxed">{t.concept.map((p,i)=>(<p key={i}>{p}</p>))}</div>
              </div>
              <div className="card p-6">
                <div className="flex items-center justify-between gap-3"><h3 className="text-2xl label">é—œæ–¼</h3><Badge>ABOUT</Badge></div>
                <div className="mt-3 space-y-2 text-sm leading-relaxed">{t.about.map((p,i)=>(<p key={i}>{p}</p>))}</div>
              </div>
            </section>

            {/* é›¢ç·š/é›²ç«¯ ç°½åˆ°ç•™è¨€æ¿ */}
            <SignBoard t={t} />
          </div>

          <WorkModal open={!!open} onClose={()=>setOpen(null)} w={open} t={t} />
          {showPunch && <PunchOverlay t={t} onEnter={()=>setShowPunch(false)} />}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('app')).render(<App />);
  </script>
</body>
</html>
