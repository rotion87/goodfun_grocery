<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>2025 å­¤èŠ³å°éšŠ GOOD FUN TEAM in è‰ç‡å­£</title>
<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Bangers&family=Noto+Sans+TC:wght@400;600;700;900&display=swap" rel="stylesheet"/>

<style>
:root{ --yellow:#ffe200; --ink:#111; --cream:#fff7ce; }
html,body{height:100%}
body{
  font-family:'Noto Sans TC',system-ui,-apple-system,Segoe UI,Roboto,'PingFang TC','Microsoft JhengHei',sans-serif;
  background:var(--cream);
  background-image:repeating-radial-gradient(circle at center,#fff 0 2px,transparent 3px 40px);
  color:var(--ink); overflow-x:hidden;
}
.hero{font-family:'Bangers';color:#111;text-shadow:2px 2px 0 #fff;}
.card{background:#fff;border:3px solid #000;border-radius:1.5rem;box-shadow:4px 4px 0 #000;}
/* å·¦ä¸‹èªè¨€åˆ‡æ›ï¼šéµå®ˆå®‰å…¨å€ï¼›æ‰“å­—æ™‚è‡ªå‹•æ·¡å‡º */
.lang-fab{position:fixed;left:1rem;bottom:calc(env(safe-area-inset-bottom,0px)+1rem);z-index:50;}
.hide-lang .lang-fab{opacity:0;pointer-events:none;transform:translateY(150%);transition:.25s;}
/* æ‰‹æ©Ÿåº•éƒ¨ç•™ç™½ï¼Œé¿å…è¢«èªè¨€åˆ‡æ›é®ä½ */
.safe-bottom{padding-bottom:calc(env(safe-area-inset-bottom,0px) + 108px);}
@supports (height:100dvh){ .vh-screen{min-height:100dvh;} }

/* --- æ‰“å¡æ©Ÿæ¨£å¼ï¼ˆpointer/touch/mouse é€šåƒï¼‰ --- */
.punch-stage{position:relative;width:min(720px,92vw);margin:0 auto;}
.punch-machine{width:100%;height:auto;display:block;}
.punch-slot{
  position:absolute;left:50%;top:68%;transform:translate(-50%,-50%);
  width:64%;height:18px;background:#111;border-radius:6px;opacity:.9;box-shadow:0 2px 0 #0006;
}
.punch-card{
  position:absolute;left:50%;top:56%;transform:translate(-50%,-50%);
  width:min(58%,420px);aspect-ratio:3/2;border:4px solid #111;border-radius:12px;background:#fff;overflow:hidden;
  box-shadow:8px 10px 0 #111; touch-action:none; user-select:none; cursor:grab; z-index:5;
}
.punch-card:active{cursor:grabbing;}
.punch-stamp{
  position:absolute; right:10px; bottom:10px; background:#fff; border:3px dashed #111;
  padding:.35rem .6rem; border-radius:8px; font-family:ui-monospace,Menlo,Consolas,monospace;
  font-weight:800; letter-spacing:.5px; opacity:0; transform:scale(.8);
  transition:opacity .25s ease, transform .25s ease;
}
.punch-stamp.show{opacity:1; transform:scale(1);}
.punch-fade{animation:pfade .5s ease forwards;}
@keyframes pfade{to{opacity:0;visibility:hidden;}}

/* æ°´æœæµ®å‹• */
.fruit{position:absolute;font-size:2rem;animation:float 20s linear infinite;white-space:nowrap;}
@keyframes float{0%{transform:translateY(0)}100%{transform:translateY(-100vh)}}
</style>
</head>
<body class="safe-bottom">
<div id="root"></div>

<script type="text/babel">
/* ==== è¨­å®š ==== */
const API_URL = "https://script.google.com/macros/s/AKfycbyqXdNd0VsgaDg3jNIMmL3A3dSYjnovi54AC-ze1buRO0mK7AMOLeo3JquQwpSSABU/exec";
const FRUITS = ["ğŸ","ğŸŠ","ğŸ‹","ğŸ‰","ğŸ‡","ğŸ“","ğŸ‘","ğŸ","ğŸŒ"];

const LANGS={tw:"ğŸ‡¹ğŸ‡¼",en:"ğŸ‡ºğŸ‡¸",ja:"ğŸ‡¯ğŸ‡µ",ko:"ğŸ‡°ğŸ‡·"};
const I18N={
  tw:{title:"2025 å­¤èŠ³å°éšŠ GOOD FUN TEAM in è‰ç‡å­£",concept:"è¨­è¨ˆç†å¿µ",about:"é—œæ–¼",board:"ç•™è¨€æ¿ï¼ç°½åˆ°",hint:"è¼¸å…¥åå­—å¾Œé€å‡ºï¼ŒæœƒåŒ–èº«ç‚ºä¸€é¡†æ°´æœåœ¨ç•«é¢éŠå‹•",input:"ä½ çš„åå­—",send:"ç°½åˆ°"},
  en:{title:"2025 GOOD FUN TEAM @ Soft Pow",concept:"Concept",about:"About",board:"Board",hint:"Enter your name to appear as a floating fruit.",input:"Your name",send:"Sign"},
  ja:{title:"2025 GOOD FUN TEAM in è‰ç‡å­£",concept:"ã‚³ãƒ³ã‚»ãƒ—ãƒˆ",about:"ç´¹ä»‹",board:"æ²ç¤ºæ¿",hint:"åå‰ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ãƒ•ãƒ«ãƒ¼ãƒ„ã¨ã—ã¦ç”»é¢ã«æ¼‚ã„ã¾ã™ã€‚",input:"ãŠåå‰",send:"é€ä¿¡"},
  ko:{title:"2025 êµ¿í€íŒ€ @ ì†Œí”„íŠ¸íŒŒìš°",concept:"ë””ìì¸ ê°œë…",about:"ì†Œê°œ",board:"ê²Œì‹œíŒ",hint:"ì´ë¦„ì„ ì…ë ¥í•˜ë©´ ê³¼ì¼ë¡œ í™”ë©´ì— ë– ë‹¤ë‹™ë‹ˆë‹¤.",input:"ì´ë¦„",send:"ë³´ë‚´ê¸°"}
};

/* å·¦ä¸‹èªè¨€åˆ‡æ› */
function LangSwitcher({lang,setLang}){
  return (
    <div className="lang-fab bg-white border-2 border-black rounded-full px-3 py-2 flex gap-2 shadow-md">
      {Object.entries(LANGS).map(([k,flag])=>(
        <button key={k} onClick={()=>setLang(k)} className={`leading-none ${lang===k?'text-2xl':'text-xl'}`}>{flag}</button>
      ))}
    </div>
  );
}

/* æ‰“å¡ï¼šæ‹–æ›³å¡ç‰‡åˆ°å¡æ§½ â†’ é¡¯ç¤ºæ™‚é–“ â†’ æ·¡å‡ºé›¢å ´ */
function PunchOverlay({onEnter}){
  const cardRef=React.useRef(null);
  const slotRef=React.useRef(null);
  const stampRef=React.useRef(null);
  const [ts,setTs]=React.useState("");
  const [fade,setFade]=React.useState(false);

  React.useEffect(()=>{
    const z=n=>String(n).padStart(2,"0");
    const d=new Date();
    setTs(`${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())} ${z(d.getHours())}:${z(d.getMinutes())}:${z(d.getSeconds())}`);
  },[]);

  React.useEffect(()=>{
    const el=cardRef.current; if(!el) return;
    let startX=0,startY=0,ox=0,oy=0,drag=false;

    const get=(e)=> e.touches?.[0] ? {x:e.touches[0].clientX,y:e.touches[0].clientY} : {x:e.clientX,y:e.clientY};
    const curTranslate=()=>{
      const m=/translate\(([-0-9.]+)px,\s*([-0-9.]+)px\)/.exec(getComputedStyle(el).transform);
      return m?[parseFloat(m[1]),parseFloat(m[2])]:[0,0];
    };
    const start=(e)=>{drag=true; const p=get(e); [ox,oy]=curTranslate(); startX=p.x; startY=p.y; el.style.transition="none";};
    const move=(e)=>{
      if(!drag) return;
      e.preventDefault();
      const p=get(e); const dx=p.x-startX, dy=p.y-startY;
      el.style.transform=`translate(calc(-50% + ${ox+dx}px), calc(-50% + ${oy+dy}px))`;
    };
    const overlap=(a,b)=>!(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom);
    const end=()=>{
      if(!drag) return; drag=false;
      const a=el.getBoundingClientRect(), b=slotRef.current.getBoundingClientRect();
      if(overlap(a,b)){
        stampRef.current.classList.add("show");
        try{ new Audio("punch.mp3").play().catch(()=>{});}catch(_){}
        if(navigator.vibrate) navigator.vibrate(25);
        setTimeout(()=>{ setFade(true); setTimeout(()=>onEnter(),550); },300);
      }else{
        el.style.transition="transform .25s ease";
        el.style.transform="translate(-50%, -50%)";
      }
    };

    // ç¶å®š pointer + touch + mouseï¼ˆå…¨é¢ä¿éšªï¼‰
    el.addEventListener("pointerdown",start);
    window.addEventListener("pointermove",move,{passive:false});
    window.addEventListener("pointerup",end);
    el.addEventListener("touchstart",start,{passive:true});
    window.addEventListener("touchmove",move,{passive:false});
    window.addEventListener("touchend",end);
    el.addEventListener("mousedown",start);
    window.addEventListener("mousemove",move,{passive:false});
    window.addEventListener("mouseup",end);

    return()=>{
      el.removeEventListener("pointerdown",start);
      window.removeEventListener("pointermove",move);
      window.removeEventListener("pointerup",end);
      el.removeEventListener("touchstart",start);
      window.removeEventListener("touchmove",move);
      window.removeEventListener("touchend",end);
      el.removeEventListener("mousedown",start);
      window.removeEventListener("mousemove",move);
      window.removeEventListener("mouseup",end);
    };
  },[onEnter]);

  return (
    <div className={`fixed inset-0 z-[60] bg-white/90 backdrop-blur-sm flex items-center justify-center p-6 ${fade?'punch-fade':''}`}>
      <div className="punch-stage">
        <img src="punch.png" alt="æ‰“å¡æ©Ÿ" className="punch-machine"/>
        <div ref={slotRef} className="punch-slot" aria-hidden></div>

        <div ref={cardRef} className="punch-card" aria-label="æ‰“å¡ç´™ï¼ˆæ‹–æ›³åˆ°æ§½ï¼‰">
          <img src="punch-card.png" alt="" className="absolute inset-0 w-full h-full object-cover"/>
          <div className="absolute left-2 top-2 bg-[var(--yellow)] border-4 border-black rounded-lg shadow-[6px_6px_0_#111] px-2 py-1 font-black">GOOD FUN TEAM</div>
          <div ref={stampRef} className="punch-stamp">{ts || 'â€”:â€”:â€”'}</div>
        </div>
      </div>
      <div className="absolute bottom-4 text-xs opacity-70">æŠŠå¡ç‰‡æ‹–åˆ°é»‘è‰²å¡æ§½ä»¥é€²å…¥ç¶²ç«™</div>
    </div>
  );
}

/* æ°´æœé£„æµ®å±¤ï¼ˆè³‡æ–™ â†’ æ°´æœ+åç¨±ä¸Šæµ®ï¼‰ */
function FruitLayer({items}){
  return (
    <div className="relative h-48 overflow-hidden mt-6">
      {items.map((f,i)=>(
        <div key={i} className="fruit" style={{
          left:(5+Math.random()*90)+"%",
          bottom:(-10+Math.random()*10)+"%",
          animationDuration:(10+Math.random()*10)+"s"
        }}>
          {f.fruit} <span className="text-sm font-bold align-middle ml-1">{f.name}</span>
        </div>
      ))}
    </div>
  );
}

/* ç°½åˆ°ç•™è¨€æ¿ï¼šå…ˆ POSTï¼Œå¤±æ•— fallback GET å¯«å…¥ï¼›éŒ¯èª¤é¡¯ç¤º */
function SignBoard({t}){
  const [name,setName]=React.useState("");
  const [list,setList]=React.useState([]);
  const [posting,setPosting]=React.useState(false);
  const [err,setErr]=React.useState("");

  React.useEffect(()=>{
    fetch(API_URL).then(r=>r.json()).then(j=>{
      if(j.ok && Array.isArray(j.data)) setList(j.data);
      else setErr("è®€å–å¤±æ•—ï¼ˆ" + (j.error || 'unknown') + "ï¼‰");
    }).catch(()=>setErr("è®€å–å¤±æ•—ï¼ˆç¶²è·¯ï¼‰"));
  },[]);

  const add=async()=>{
    const n=name.trim(); if(!n) return;
    const fruit=FRUITS[Math.floor(Math.random()*FRUITS.length)];
    setErr(""); setPosting(true);

    // å…ˆç”¨ POST
    try{
      const res=await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,fruit})});
      const j=await res.json();
      if(j.ok){ setList(p=>[...p,{name:n,fruit}]); setName(""); setPosting(false); return; }
      throw new Error(j.error || "post_failed");
    }catch(_){
      // é€€è·¯ï¼šGET å¯«å…¥ï¼ˆå°æ‡‰å¾Œç«¯ doGet å¯ appendï¼‰
      try{
        const url = API_URL + `?name=${encodeURIComponent(n)}&fruit=${encodeURIComponent(fruit)}`;
        const res=await fetch(url,{method:"GET"});
        const j=await res.json();
        if(j.ok){ setList(p=>[...p,{name:n,fruit}]); setName(""); setPosting(false); return; }
        throw new Error(j.error || "get_write_failed");
      }catch(e2){
        setPosting(false);
        setErr("é€å‡ºå¤±æ•—ï¼ˆ" + (e2.message || 'ç¶²è·¯/æ¬Šé™') + "ï¼‰");
      }
    }
  };

  return (
    <div className="card p-6 mt-10 mb-24">
      <h2 className="text-2xl font-bold mb-2">{t.board}</h2>
      <p className="mb-4 opacity-80">{t.hint}ï¼ˆå·²é€£ç·šé›²ç«¯ï¼‰</p>

      <div className="mt-4 flex flex-col sm:flex-row gap-2">
        <input value={name} onChange={e=>setName(e.target.value)} placeholder={t.input}
          className="flex-1 rounded-xl border-2 border-black px-3 py-3"/>
        <button onClick={add} disabled={posting}
          className="btn w-full sm:w-auto px-4 py-3 rounded-xl bg-[var(--yellow)] border-2 border-black font-bold">
          {posting ? "é€å‡ºä¸­â€¦" : t.send}
        </button>
      </div>

      {err && <div className="mt-3 text-sm text-red-600">{err}</div>}
      <FruitLayer items={list}/>
    </div>
  );
}

function App(){
  const [lang,setLang]=React.useState("tw");
  const [entered,setEntered]=React.useState(false);
  const t=I18N[lang];

  /* æ‰“å­—æ™‚èªè¨€åˆ‡æ›æ¢æ·¡å‡ºï¼ˆé¿å…æ“‹è¼¸å…¥ï¼‰ */
  React.useEffect(()=>{
    const onIn=e=>{ if(["INPUT","TEXTAREA"].includes(e.target.tagName)) document.body.classList.add("hide-lang"); };
    const onOut=()=>document.body.classList.remove("hide-lang");
    window.addEventListener("focusin",onIn);
    window.addEventListener("focusout",onOut);
    return()=>{window.removeEventListener("focusin",onIn);window.removeEventListener("focusout",onOut);}
  },[]);

  return (
    <div className="p-4 safe-bottom">
      {!entered && <PunchOverlay onEnter={()=>setEntered(true)}/>}
      <LangSwitcher lang={lang} setLang={setLang}/>

      <h1 className="text-center text-4xl hero mb-6">{t.title}</h1>

      <div className="card p-6">
        <h2 className="text-2xl font-bold mb-2">{t.concept}</h2>
        <p>é—œæ³¨åŸå¸‚ä¸­çš„æš«å±…ã€ç§»å‹•èˆ‡å®‰æ”¾ï¼›ä»¥ã€ŒæŸ”è»Ÿ Ã— å …å›ºã€çš„åª’æå°ä½ï¼Œè«‡è¨˜æ†¶èˆ‡ç”Ÿæ´»è·é›¢ã€‚</p>
      </div>

      <div className="card p-6 mt-8">
        <h2 className="text-2xl font-bold mb-2">{t.about}</h2>
        <p>å­¤èŠ³å°éšŠ GOOD FUN TEAM ç”± Rotion87 èˆ‡ç¾…å…±åŒç¶“ç‡Ÿã€‚</p>
        <div className="flex gap-3 mt-4">
          <a href="https://www.instagram.com/rotion87" target="_blank" rel="noreferrer">
            <img src="ig-rotion.png" alt="IG rotion87" className="w-10 h-10 object-cover rounded-full border-2 border-black"/>
          </a>
          <a href="https://www.instagram.com/l72uo_" target="_blank" rel="noreferrer">
            <img src="ig-l72uo.png" alt="IG l72uo_" className="w-10 h-10 object-cover rounded-full border-2 border-black"/>
          </a>
        </div>
      </div>

      <!-- ä½œå“ç¤ºç¯„å¡ç‰‡ï¼šå¯å†è‡ªè¡Œæ“´å…… -->
      <div className="grid sm:grid-cols-2 gap-6 mt-8">
        <div className="card p-3">
          <img src="./exhibit-radio.png" alt="å±•ç¤ºç‰©ï½œå­¤èŠ³æ”¶éŸ³æ©Ÿ" className="w-full h-52 object-cover bg-gray-100"/>
          <div className="p-2 text-sm font-bold mt-1">å±•ç¤ºç‰©ï½œå­¤èŠ³æ”¶éŸ³æ©Ÿ</div>
        </div>
        <div className="card p-3">
          <img src="./exhibit-pipo.png" alt="å±•ç¤ºç‰©ï½œPIPOå› å¼µå­" className="w-full h-52 object-cover bg-gray-100"/>
          <div className="p-2 text-sm font-bold mt-1">å±•ç¤ºç‰©ï½œPIPOå› å¼µå­</div>
        </div>
      </div>

      <SignBoard t={t}/>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
